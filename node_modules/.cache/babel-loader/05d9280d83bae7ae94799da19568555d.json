{"ast":null,"code":"\"use strict\";\n\nvar mockExpectation = require(\"./mock-expectation\");\n\nvar spyCallToString = require(\"./call\").toString;\n\nvar extend = require(\"./util/core/extend\");\n\nvar match = require(\"./match\");\n\nvar deepEqual = require(\"./util/core/deep-equal\").use(match);\n\nvar wrapMethod = require(\"./util/core/wrap-method\");\n\nvar push = Array.prototype.push;\n\nfunction mock(object) {\n  if (!object || typeof object === \"string\") {\n    return mockExpectation.create(object ? object : \"Anonymous mock\");\n  }\n\n  return mock.create(object);\n}\n\nfunction each(collection, callback) {\n  var col = collection || [];\n  col.forEach(callback);\n}\n\nfunction arrayEquals(arr1, arr2, compareLength) {\n  if (compareLength && arr1.length !== arr2.length) {\n    return false;\n  }\n\n  return arr1.every(function (element, i) {\n    return deepEqual(element, arr2[i]);\n  });\n}\n\nextend(mock, {\n  create: function create(object) {\n    if (!object) {\n      throw new TypeError(\"object is null\");\n    }\n\n    var mockObject = extend({}, mock);\n    mockObject.object = object;\n    delete mockObject.create;\n    return mockObject;\n  },\n  expects: function expects(method) {\n    if (!method) {\n      throw new TypeError(\"method is falsy\");\n    }\n\n    if (!this.expectations) {\n      this.expectations = {};\n      this.proxies = [];\n      this.failures = [];\n    }\n\n    if (!this.expectations[method]) {\n      this.expectations[method] = [];\n      var mockObject = this;\n      wrapMethod(this.object, method, function () {\n        return mockObject.invokeMethod(method, this, arguments);\n      });\n      push.call(this.proxies, method);\n    }\n\n    var expectation = mockExpectation.create(method);\n    push.call(this.expectations[method], expectation);\n    return expectation;\n  },\n  restore: function restore() {\n    var object = this.object;\n    each(this.proxies, function (proxy) {\n      if (typeof object[proxy].restore === \"function\") {\n        object[proxy].restore();\n      }\n    });\n  },\n  verify: function verify() {\n    var expectations = this.expectations || {};\n    var messages = this.failures ? this.failures.slice() : [];\n    var met = [];\n    each(this.proxies, function (proxy) {\n      each(expectations[proxy], function (expectation) {\n        if (!expectation.met()) {\n          push.call(messages, expectation.toString());\n        } else {\n          push.call(met, expectation.toString());\n        }\n      });\n    });\n    this.restore();\n\n    if (messages.length > 0) {\n      mockExpectation.fail(messages.concat(met).join(\"\\n\"));\n    } else if (met.length > 0) {\n      mockExpectation.pass(messages.concat(met).join(\"\\n\"));\n    }\n\n    return true;\n  },\n  invokeMethod: function invokeMethod(method, thisValue, args) {\n    /* if we cannot find any matching files we will explicitly call mockExpection#fail with error messages */\n\n    /* eslint consistent-return: \"off\" */\n    var expectations = this.expectations && this.expectations[method] ? this.expectations[method] : [];\n    var currentArgs = args || [];\n    var available;\n    var expectationsWithMatchingArgs = expectations.filter(function (expectation) {\n      var expectedArgs = expectation.expectedArguments || [];\n      return arrayEquals(expectedArgs, currentArgs, expectation.expectsExactArgCount);\n    });\n    var expectationsToApply = expectationsWithMatchingArgs.filter(function (expectation) {\n      return !expectation.met() && expectation.allowsCall(thisValue, args);\n    });\n\n    if (expectationsToApply.length > 0) {\n      return expectationsToApply[0].apply(thisValue, args);\n    }\n\n    var messages = [];\n    var exhausted = 0;\n    expectationsWithMatchingArgs.forEach(function (expectation) {\n      if (expectation.allowsCall(thisValue, args)) {\n        available = available || expectation;\n      } else {\n        exhausted += 1;\n      }\n    });\n\n    if (available && exhausted === 0) {\n      return available.apply(thisValue, args);\n    }\n\n    expectations.forEach(function (expectation) {\n      push.call(messages, \"    \" + expectation.toString());\n    });\n    messages.unshift(\"Unexpected call: \" + spyCallToString.call({\n      proxy: method,\n      args: args\n    }));\n    var err = new Error();\n\n    if (!err.stack) {\n      // PhantomJS does not serialize the stack trace until the error has been thrown\n      try {\n        throw err;\n      } catch (e) {\n        /* empty */\n      }\n    }\n\n    this.failures.push(\"Unexpected call: \" + spyCallToString.call({\n      proxy: method,\n      args: args,\n      stack: err.stack\n    }));\n    mockExpectation.fail(messages.join(\"\\n\"));\n  }\n});\nmodule.exports = mock;","map":{"version":3,"sources":["/home/hoss/my App/my-app/node_modules/sinon/lib/sinon/mock.js"],"names":["mockExpectation","require","spyCallToString","toString","extend","match","deepEqual","use","wrapMethod","push","Array","prototype","mock","object","create","each","collection","callback","col","forEach","arrayEquals","arr1","arr2","compareLength","length","every","element","i","TypeError","mockObject","expects","method","expectations","proxies","failures","invokeMethod","arguments","call","expectation","restore","proxy","verify","messages","slice","met","fail","concat","join","pass","thisValue","args","currentArgs","available","expectationsWithMatchingArgs","filter","expectedArgs","expectedArguments","expectsExactArgCount","expectationsToApply","allowsCall","apply","exhausted","unshift","err","Error","stack","e","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar mockExpectation = require(\"./mock-expectation\");\nvar spyCallToString = require(\"./call\").toString;\nvar extend = require(\"./util/core/extend\");\nvar match = require(\"./match\");\nvar deepEqual = require(\"./util/core/deep-equal\").use(match);\nvar wrapMethod = require(\"./util/core/wrap-method\");\n\nvar push = Array.prototype.push;\n\nfunction mock(object) {\n    if (!object || typeof object === \"string\") {\n        return mockExpectation.create(object ? object : \"Anonymous mock\");\n    }\n\n    return mock.create(object);\n}\n\nfunction each(collection, callback) {\n    var col = collection || [];\n\n    col.forEach(callback);\n}\n\nfunction arrayEquals(arr1, arr2, compareLength) {\n    if (compareLength && (arr1.length !== arr2.length)) {\n        return false;\n    }\n\n    return arr1.every(function (element, i) {\n        return deepEqual(element, arr2[i]);\n\n    });\n}\n\nextend(mock, {\n    create: function create(object) {\n        if (!object) {\n            throw new TypeError(\"object is null\");\n        }\n\n        var mockObject = extend({}, mock);\n        mockObject.object = object;\n        delete mockObject.create;\n\n        return mockObject;\n    },\n\n    expects: function expects(method) {\n        if (!method) {\n            throw new TypeError(\"method is falsy\");\n        }\n\n        if (!this.expectations) {\n            this.expectations = {};\n            this.proxies = [];\n            this.failures = [];\n        }\n\n        if (!this.expectations[method]) {\n            this.expectations[method] = [];\n            var mockObject = this;\n\n            wrapMethod(this.object, method, function () {\n                return mockObject.invokeMethod(method, this, arguments);\n            });\n\n            push.call(this.proxies, method);\n        }\n\n        var expectation = mockExpectation.create(method);\n        push.call(this.expectations[method], expectation);\n\n        return expectation;\n    },\n\n    restore: function restore() {\n        var object = this.object;\n\n        each(this.proxies, function (proxy) {\n            if (typeof object[proxy].restore === \"function\") {\n                object[proxy].restore();\n            }\n        });\n    },\n\n    verify: function verify() {\n        var expectations = this.expectations || {};\n        var messages = this.failures ? this.failures.slice() : [];\n        var met = [];\n\n        each(this.proxies, function (proxy) {\n            each(expectations[proxy], function (expectation) {\n                if (!expectation.met()) {\n                    push.call(messages, expectation.toString());\n                } else {\n                    push.call(met, expectation.toString());\n                }\n            });\n        });\n\n        this.restore();\n\n        if (messages.length > 0) {\n            mockExpectation.fail(messages.concat(met).join(\"\\n\"));\n        } else if (met.length > 0) {\n            mockExpectation.pass(messages.concat(met).join(\"\\n\"));\n        }\n\n        return true;\n    },\n\n    invokeMethod: function invokeMethod(method, thisValue, args) {\n        /* if we cannot find any matching files we will explicitly call mockExpection#fail with error messages */\n        /* eslint consistent-return: \"off\" */\n        var expectations = this.expectations && this.expectations[method] ? this.expectations[method] : [];\n        var currentArgs = args || [];\n        var available;\n\n        var expectationsWithMatchingArgs = expectations.filter(function (expectation) {\n            var expectedArgs = expectation.expectedArguments || [];\n\n            return arrayEquals(expectedArgs, currentArgs, expectation.expectsExactArgCount);\n        });\n\n        var expectationsToApply = expectationsWithMatchingArgs.filter(function (expectation) {\n            return !expectation.met() && expectation.allowsCall(thisValue, args);\n        });\n\n        if (expectationsToApply.length > 0) {\n            return expectationsToApply[0].apply(thisValue, args);\n        }\n\n        var messages = [];\n        var exhausted = 0;\n\n        expectationsWithMatchingArgs.forEach(function (expectation) {\n            if (expectation.allowsCall(thisValue, args)) {\n                available = available || expectation;\n            } else {\n                exhausted += 1;\n            }\n        });\n\n        if (available && exhausted === 0) {\n            return available.apply(thisValue, args);\n        }\n\n        expectations.forEach(function (expectation) {\n            push.call(messages, \"    \" + expectation.toString());\n        });\n\n        messages.unshift(\"Unexpected call: \" + spyCallToString.call({\n            proxy: method,\n            args: args\n        }));\n\n        var err = new Error();\n        if (!err.stack) {\n            // PhantomJS does not serialize the stack trace until the error has been thrown\n            try {\n                throw err;\n            } catch (e) {/* empty */}\n        }\n        this.failures.push(\"Unexpected call: \" + spyCallToString.call({\n            proxy: method,\n            args: args,\n            stack: err.stack\n        }));\n\n        mockExpectation.fail(messages.join(\"\\n\"));\n    }\n});\n\nmodule.exports = mock;\n"]},"metadata":{},"sourceType":"script"}